---
title: "Hepatisis data analysis"
output:
  html_document: 
      number_sections: true 
---

```{r, warning=FALSE, message=FALSE}
library(dplyr)
library(visdat)
library(caret)
library(RANN)
library(corrplot)
library(plotly)
```

# Introduction 

First rows of our data frame.


```{r}
df <- read.table("hepatitis.data", sep = ",")
colnames(df) <- c("Class","Age","Sex","Steroid","Antivirals","Fatigue","Malaise","Anorexia","LiverBig","LiverFirm","SpleenPalpable","Spiders","Ascites","Varices","Bilirubin","AlkPhosphate","Sgot","Albumin","Protime","Histology") # nolint
attach(df)
```

```{r}
head(df)
```

# Preparing data
```{r}
df[df == "?"] <- NA

df <- mutate_all(df, function(x) as.numeric(as.character(x)))
```

```{r}
sum(rowSums(is.na(df)) != 0) # we cannot remove these rows!
sum(is.na(df))
vis_dat(df)
# vis_dat(df2)
```

```{r}
df2 <- df
data_transform <- preProcess(df2, method = "knnImpute")
# data_transform <- preProcess(df, method = "bagImpute")

df2 <- predict(data_transform, df2)
```


```{r echo=FALSE}
for (i in 1:20) {
  column <- df[, i]
  if (i %in% c(15, 18)) {
    df2[, i] <- df2[, i] * sd(na.omit(column)) + mean(na.omit(column))
  } else {
    df2[, i] <- round(df2[, i] * sd(na.omit(column)) + mean(na.omit(column)))
  }
}

categorical <- c(1, 3:14, 20)
df2[, categorical] <- replace(df2[, categorical], df2[, categorical] == 2, 0)
df2[, categorical] <-  lapply(df2[, categorical], as.factor)
# df2[, c(2, 16:17, 19)] <- lapply(df2[, c(2, 16:17, 19)], as.integer)
```

```{r fig1, fig.height = 10, fig.width = 10, fig.align = 'center'}
cor_matrix <- cor(df2[, sapply(df2, is.numeric)], method = "pearson")
corrplot(cor_matrix, tl.col = "black", addCoef.col = 1, number.cex = 0.9)
```