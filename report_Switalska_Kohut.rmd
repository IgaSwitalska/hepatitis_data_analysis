---
title: "Hepatisis data analysis"
output:
  html_document: 
      number_sections: true 
---

```{r, warning=FALSE, message=FALSE}
library(dplyr)
library(visdat)
library(caret)
library(RANN)
library(corrplot)
library(plotly)
```

# Introduction 

First rows of our data frame.


```{r}
df <- read.table("hepatitis.data", sep = ",")
colnames(df) <- c("Class","Age","Sex","Steroid","Antivirals","Fatigue","Malaise","Anorexia","LiverBig","LiverFirm","SpleenPalpable","Spiders","Ascites","Varices","Bilirubin","AlkPhosphate","Sgot","Albumin","Protime","Histology") # nolint
attach(df)
```

```{r}
head(df)
```

# Preparing data
```{r}
df[df == "?"] <- NA

df <- mutate_all(df, function(x) as.numeric(as.character(x)))

for (i in c(1, 3:14, 20)) {
  df[, i] <- replace(df[, i], df[, i] == 2, 0)
  df[, i] <- as.factor(df[, i])
}

for (i in c(2, 16:19)) {
  df[, i] <- as.integer(df[, i])
}

df[, 15] <- as.numeric(df[, 15])

# lapply(df, unique)
```

```{r}
sum(rowSums(is.na(df)) != 0) # we cannot remove these rows!
vis_dat(df2)
# vis_dat(df2)
```

```{r}
# df_new <- df[, -19] # df without protime
# df_new <- df[-which(rowSums(is.na(df)) > 5), ]

# data_transform <- preProcess(df, method = "knnImpute")
data_transform <- preProcess(df, method = "bagImpute")
df2 <- predict(data_transform, df)

sum(rowSums(is.na(df2)) != 0)
sum(is.na(df2))

```

```{r fig1, fig.height = 10, fig.width = 10, fig.align = 'center'}
# df2.cor <- cor(df2)
corrplot(cor(df2), tl.col = "black", addCoef.col = 1, number.cex = 0.9)
```